<!DOCTYPE html>
<html lang="tr" data-bs-theme="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ app_name }} - Komuta Merkezi</title>

    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link
        href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Inter:wght@300;400;600&display=swap"
        rel="stylesheet">

    <style>
        :root {
            --bg-dark: #0d1117;
            --card-bg: #161b22;
            --border-color: #30363d;
            --accent-color: #58a6ff;
        }

        body {
            background-color: var(--bg-dark);
            color: #c9d1d9;
            font-family: 'Inter', sans-serif;
            background-image: radial-gradient(#30363d 1px, transparent 1px);
            background-size: 30px 30px;
            padding-bottom: 50px;
        }

        .navbar {
            background-color: rgba(22, 27, 34, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--border-color);
            padding: 1rem 2rem;
        }

        .navbar-brand {
            font-family: 'JetBrains Mono', monospace;
            font-weight: 700;
            color: var(--accent-color) !important;
        }

        .target-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
            gap: 25px;
            padding: 25px;
        }

        .target-card {
            background-color: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s;
        }

        .target-card:hover {
            transform: translateY(-5px);
            border-color: var(--accent-color);
        }

        .card-header {
            padding: 15px 20px;
            background: rgba(255, 255, 255, 0.02);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .status-badge {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
        }

        .status-up {
            background: rgba(35, 134, 54, 0.2);
            color: #3fb950;
            border: 1px solid rgba(35, 134, 54, 0.4);
        }

        .status-down {
            background: rgba(218, 54, 51, 0.2);
            color: #f85149;
            border: 1px solid rgba(218, 54, 51, 0.4);
        }

        .port-list {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-bottom: 15px;
        }

        .port-badge {
            background: #21262d;
            border: 1px solid #30363d;
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 0.75rem;
            font-family: 'JetBrains Mono', monospace;
        }

        .vuln-container {
            display: flex;
            flex-direction: column;
            gap: 12px;
            max-height: 400px;
            overflow-y: auto;
            padding-right: 5px;
        }

        .vuln-item {
            font-size: 0.8rem;
            padding: 15px;
            border-radius: 8px;
            background-color: #0d1117;
            border-left: 4px solid #30363d;
            font-family: 'JetBrains Mono', monospace;
            white-space: pre-wrap;
            line-height: 1.5;
            position: relative;
        }

        .vuln-container::-webkit-scrollbar {
            width: 6px;
        }

        .vuln-container::-webkit-scrollbar-thumb {
            background: #30363d;
            border-radius: 3px;
        }

        .vuln-cve {
            border-left-color: #da3633;
            background: linear-gradient(90deg, rgba(218, 54, 51, 0.05), transparent);
        }

        .vuln-ssl {
            border-left-color: #238636;
            background: linear-gradient(90deg, rgba(35, 134, 54, 0.05), transparent);
        }

        .vuln-web {
            border-left-color: #58a6ff;
            background: linear-gradient(90deg, rgba(88, 166, 255, 0.05), transparent);
        }

        .vuln-headers {
            border-left-color: #a371f7;
            background: linear-gradient(90deg, rgba(163, 113, 247, 0.05), transparent);
        }

        .hl-title {
            color: #58a6ff;
            font-weight: bold;
            display: block;
            margin-top: 5px;
        }

        .hl-cve {
            color: #ff7b72;
            font-weight: bold;
            text-decoration: underline;
        }

        .hl-header {
            color: #a371f7;
            font-weight: bold;
            display: block;
            margin-top: 8px;
            border-top: 1px dashed #444;
            padding-top: 5px;
        }

        .hl-success {
            color: #3fb950;
            font-weight: bold;
        }

        .status-scan {
            background: rgba(88, 166, 255, 0.08);
            color: #58a6ff;
            border: 1px solid rgba(88, 166, 255, 0.4);
            position: relative;
            overflow: hidden;
        }

        .status-scan::after {
            content: "";
            position: absolute;
            top: 0;
            left: -40%;
            width: 40%;
            height: 100%;
            background: linear-gradient(
                120deg,
                transparent,
                rgba(88,166,255,0.6),
                transparent
            );
            animation: scan-glow 1.4s linear infinite;
        }

        @keyframes scan-glow {
            from { left: -40%; }
            to   { left: 120%; }
        }

        .scan-text::after {
            content: "";
            animation: dots 1.5s steps(3, end) infinite;
        }

        @keyframes dots {
            0%   { content: ""; }
            33%  { content: "."; }
            66%  { content: ".."; }
            100% { content: "..."; }
        }

        .target-card.scanning {
            position: relative;
            animation: scan-pulse 2.2s ease-in-out infinite;
            border-color: rgba(88, 166, 255, 0.6);
        }

        @keyframes scan-pulse {
            0% {
                box-shadow:
                    0 0 0 rgba(88,166,255,0.0),
                    0 0 0 rgba(88,166,255,0.0);
            }

            50% {
                box-shadow:
                    0 0 18px rgba(88,166,255,0.25),
                    0 0 35px rgba(88,166,255,0.15);
            }

            100% {
                box-shadow:
                    0 0 0 rgba(88,166,255,0.0),
                    0 0 0 rgba(88,166,255,0.0);
            }
        }


    </style>
</head>

<body>

    <nav class="navbar navbar-expand-lg navbar-dark sticky-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="#"><i class="fa-solid fa-tower-observation"></i> {{ app_name }}</a>
            <button class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#addTargetModal">
                <i class="fa-solid fa-plus"></i> Yeni Hedef
            </button>
        </div>
    </nav>

    <div class="target-grid">
        {% for target in targets %}
        <div class="target-card {% if target.status and target.status.startswith('TaranÄ±yor') %}scanning{% endif %}">
            <div class="card-header">
                <div>
                    <div style="font-weight:bold; color:white; font-size:1.1rem;">{{ target.name }}</div>
                    <a href="{{ target.url }}" target="_blank"
                        style="color:#8b949e; text-decoration:none; font-size:0.85rem;">{{ target.url }}</a>
                </div>
                <div class="d-flex align-items-center gap-2">
                    {% if target.status and target.status.startswith("TaranÄ±yor") %}
                <span class="status-badge status-scan">SCAN</span>

                    
                    {% elif target.status and target.status.startswith("Aktif") %}
                    <span class="status-badge status-up">UP</span>
                    
                    {% elif target.status and target.status.startswith("Hata") %}
                    <span class="status-badge status-down">DOWN</span>
                    
                    {% else %}
                    <span class="status-badge status-down">DOWN</span>
                    {% endif %}

                    <div class="dropdown">
                        <button class="btn btn-link text-muted p-0" type="button" data-bs-toggle="dropdown"><i
                                class="fa-solid fa-ellipsis-vertical"></i></button>
                        <ul class="dropdown-menu dropdown-menu-dark">
                            <li><a class="dropdown-item" href="#"
                                    onclick="fillEditModal('{{ target.id }}', '{{ target.name }}', '{{ target.url }}')"
                                    data-bs-toggle="modal" data-bs-target="#editTargetModal">DÃ¼zenle</a></li>
                            <li>
                                <form action="/delete/{{ target.id }}" method="post" onsubmit="return confirm('Sil?');"
                                    class="m-0"><button class="dropdown-item text-danger">Sil</button></form>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="card-body p-3 flex-grow-1">
                {% if target.last_error %}
                <div class="alert alert-danger p-2 mb-3" style="font-size:0.8rem"><i
                        class="fa-solid fa-triangle-exclamation"></i> {{ target.last_error }}</div>
                {% endif %}

                {% if target.open_ports %}
                <div class="port-list">
                    {% for port in target.open_ports.split(',') %}
                    <span class="port-badge"><i class="fa-solid fa-plug"></i> {{ port }}</span>
                    {% endfor %}
                </div>
                {% endif %}

                {% if target.vulns %}
                <div class="vuln-container"
                    style="display: flex; flex-direction: column; gap: 10px; max-height: 400px; overflow-y: auto;">
                    {% if target.vulns %}
                    {% for vuln_item in target.vulns.split('|') %}
                    {% set clean_item = vuln_item | replace('p80:', '') | replace('p443:', '') | replace('p25:', '') | replace('p8080:',
                    '') | replace('vulners:', '') %}
                
                    {% if 'CVE-' in vuln_item or 'vulners' in vuln_item %}
                    <div class="vuln-card error-card"
                        style="background: rgba(220, 53, 69, 0.1); border-left: 4px solid #dc3545; padding: 12px; border-radius: 4px;">
                        <strong style="color: #dc3545; display: block; margin-bottom: 5px;">
                            <i class="fa-solid fa-biohazard"></i> KRÄ°TÄ°K ZAFÄ°YET
                        </strong>
                        <div style="font-family: 'JetBrains Mono', monospace; font-size: 0.8rem; color: #eecbc4;">
                            {{ clean_item
                            | replace('CVE-', '<a href="https://www.google.com/search?q=CVE-" target="_blank"
                                style="color:#ff6b6b; font-weight:bold; text-decoration:underline;">CVE-')
                                | replace('*EXPLOIT*', '<span class="badge bg-danger">EXPLOIT VAR</span>')
                                | replace('https://vulners.com', '<br>ðŸ”— ')
                                | safe
                                }}</a>
                        </div>
                    </div>
                
                {% elif 'http-security-headers' in vuln_item|lower %}
                <div class="vuln-card security-card"
                    style="background: rgba(111, 66, 193, 0.1); border-left: 4px solid #6f42c1; padding: 12px; border-radius: 4px;">
                    <strong style="color: #a371f7; display: block; margin-bottom: 5px;">
                        <i class="fa-solid fa-shield-halved"></i> GÃœVENLÄ°K BAÅžLIKLARI
                    </strong>
                    <div style="font-family: 'JetBrains Mono', monospace; font-size: 0.8rem; color: #d0bfff;">
                        {{ clean_item
                        | replace('[http-security-headers]:', '')
                        | replace('[http-security-headers]', '')
                        | replace('http-security-headers:', '')
                        | replace('Header:', '<br>â€¢ <strong>Header:</strong>')
                        | replace('Description:', '<br>&nbsp;&nbsp;Desc:')
                        | safe
                        }}
                    </div>
                </div>

                
                    {% elif 'ssl-cert' in vuln_item %}
                    <div class="vuln-card ssl-card"
                        style="background: rgba(25, 135, 84, 0.1); border-left: 4px solid #198754; padding: 12px; border-radius: 4px;">
                        <strong style="color: #20c997; display: block; margin-bottom: 5px;">
                            <i class="fa-solid fa-lock"></i> SSL SERTÄ°FÄ°KASI
                        </strong>
                        <div style="font-family: 'JetBrains Mono', monospace; font-size: 0.8rem; color: #a3cfbb;">
                            {{ clean_item | replace('[ssl-cert]:', '') | safe }}
                        </div>
                    </div>
                
                    {% elif 'http-server' in vuln_item or 'http-title' in vuln_item %}
                    <div class="vuln-card info-card"
                        style="background: rgba(13, 202, 240, 0.1); border-left: 4px solid #0dcaf0; padding: 12px; border-radius: 4px;">
                        <strong style="color: #0dcaf0; display: block; margin-bottom: 5px;">
                            <i class="fa-solid fa-server"></i> WEB ANALÄ°ZÄ°
                        </strong>
                        <div style="font-family: 'JetBrains Mono', monospace; font-size: 0.8rem; color: #9eeaf9;">
                            {{ clean_item | replace('[http-server-header]:', 'Sunucu:') | replace('[http-title]:', 'BaÅŸlÄ±k:') }}
                        </div>
                    </div>
                
                    {% else %}
                    <div class="vuln-card generic-card"
                        style="background: rgba(255, 255, 255, 0.05); border-left: 4px solid #6c757d; padding: 12px; border-radius: 4px;">
                        <strong style="color: #adb5bd; display: block; margin-bottom: 5px;">
                            <i class="fa-solid fa-info-circle"></i> BÄ°LGÄ°
                        </strong>
                        <div style="font-family: 'JetBrains Mono', monospace; font-size: 0.8rem; color: #ced4da;">
                            {{ clean_item }}
                        </div>
                    </div>
                    {% endif %}
                
                    {% endfor %}
                    {% else %}
                    <div class="text-muted text-center py-3" style="font-size: 0.8rem;">
                        <i class="fa-solid fa-check-circle text-success"></i> Temiz! Zafiyet bulunamadÄ± veya tarama bekleniyor.
                    </div>
                    {% endif %}
                </div>
            {% endif %}

            <div class="text-end mt-3 text-muted" style="font-size:0.7rem">
                <i class="fa-regular fa-clock"></i> {{ target.last_check.strftime('%H:%M:%S') if target.last_check else
                '-' }}
            </div>
        </div>
    </div>
    {% endfor %}
    </div>

    <div class="modal fade" id="addTargetModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Yeni Hedef</h5><button type="button" class="btn-close btn-close-white"
                        data-bs-dismiss="modal"></button>
                </div>
                <form action="/add" method="post">
                    <div class="modal-body">
                        <input type="text" name="name" class="form-control mb-2" placeholder="Ä°sim" required>
                        <input type="url" name="url" class="form-control" placeholder="URL" required>
                    </div>
                    <div class="modal-footer"><button class="btn btn-primary">Ekle</button></div>
                </form>
            </div>
        </div>
    </div>

    <div class="modal fade" id="editTargetModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">DÃ¼zenle</h5><button type="button" class="btn-close btn-close-white"
                        data-bs-dismiss="modal"></button>
                </div>
                <form id="editForm" method="post">
                    <div class="modal-body">
                        <input type="text" id="editName" name="name" class="form-control mb-2" required>
                        <input type="url" id="editUrl" name="url" class="form-control" required>
                    </div>
                    <div class="modal-footer"><button class="btn btn-warning">GÃ¼ncelle</button></div>
                </form>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/js/bootstrap.bundle.min.js"></script>
    <script>
        function fillEditModal(id, name, url) {
            document.getElementById('editName').value = name;
            document.getElementById('editUrl').value = url;
            document.getElementById('editForm').action = "/update/" + id;
        }
        setInterval(() => { if (!document.querySelector('.modal.show')) window.location.reload(); }, 10000);
    </script>
</body>

</html>